- name: Install postfix to send alert emails
  dnf:
    name: postfix
    state: latest

- name: copy main.cf
  copy:
    src: files/postfix-main.cf
    dest: /etc/postfix/main.cf



- name: copy sasl_password
  copy:
    src: files/sasl_password
    dest: /etc/postfix/sasl_password

- name: enable and start postfix
  systemd:
    name: postfix
    state: started
    enabled: yes

- name: install dnf automatic
  dnf:
    name: dnf-automatic
    state: latest

- name: dnf-automatic
  copy:
    src: files/dnf-automatic.conf
    dest: /etc/dnf/automatic.conf
    owner: root
    group: root
    mode: 0644

- name: enable a timer for dnf-automatic
  systemd:
    name: dnf-automatic.timer
    state: started
    enabled: yes

- shell: credstash -r eu-west-1 get ses/smtp-password
  register: credstash_smtp_password_output

- shell: credstash -r eu-west-1 get ses/smtp-username
  register: credstash_smtp_username_output
